# Микросервисы: принципы

## API Gateway
При выборе API Gateway руководствовался следующими принципами:
* решение с открытым кодом
* возможность использования on-premise
* соответствие требованиям задания:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

По результатам беглого гугления выбрал следующие API GW для сравнения:
* NGINX
* Kong
* Tyk.io
* Apache APISIX
* Krakend

Требование                  |NGINX         |Kong          |Tyk           |APISIX         |Krakend
----------------------------|--------------|--------------|--------------|---------------|----------
Аутентификация              |+             |++            |+             |+              |+
Маршрутизация запросов      |+             |+             |+             |+              |+
Терминация HTTPS            |+             |+             |+             |+              |+
Заявлена высокая произв.    |              |              |              |+              |быстрее Kong и Tyk (?)
Контроль трафика            |+             |+             |+             |+              |++
Поддержка плагинов          |-             |+             |-             |+              |+
Централизованное управление конфигурацией |-|внешняя БД   |-             |+              |-
Протоколы                   |gRPC, REST    |gRPC, REST, GraphQL (в платной версии), AsyncAPI (есть конвертация протоколов)|gRPC, REST, GraphQL|gRPC, REST, GraphQL|gRPC, REST, GraphQL
Конвертирование протоколов  |-             |+             |-             |+              |+-
Оркестрация запросов        |-             |+             |+             |-              |-
Полная функциональность в бесплатной версии|+|--          |+             |-              |-
Основан на...               |нет           |NGINX         |нет           |NGINX          |нет

Судя по всему, требования, заявленные в условии задачи, выполняются для большинства зрелых API GW, по крайней мере, для всех, которые
были отобраны для анализа. Отличия в решениях небольшие, сложно сделать выбор без тестирования решений или без дополнительной информации об используемом стеке (например, Kong
использует Cassandra в качестве БД, а APISIX - более распространенное и простое хранилище etcd). Я бы предложил выбрать для начала Tyk, т.к. он имеет 
богатую функциональность в бесплатной версии.

## Брокер сообщений

Требование                                               | Kafka       | RabbitMQ    | Redis       | Beanstalk  
---------------------------------------------------------|-------------|-------------|-------------|---------
поддержка кластеризации для обеспечения надёжности       |+|+|-|-
хранение сообщений на диске в процессе доставки          |+|+|-|+
высокая скорость работы                                  |+|-|+|+
поддержка различных форматов сообщений                   |+|+|-|-
разделение прав доступа к различным потокам сообщений    |+|+|+|-
простота эксплуатации                                    |-|+|-|+

Т.о. с учетом приведенных требований выбор стоит между Kafka и RabbitMQ. Т.к. RabbitMQ более простой в настройке и более универсальный, можно начать с него и попробовать, нормально ли он работает.
