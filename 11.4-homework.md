# Микросервисы: масштабирование

## Кластеризация

### Постановка задачи

Предложите решение для обеспечения развёртывания, запуска и управления приложениями. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
<br>
Решение должно соответствовать следующим требованиям:

- поддержка контейнеров;
- обеспечивать обнаружение сервисов и маршрутизацию запросов;
- обеспечивать возможность горизонтального масштабирования;
- обеспечивать возможность автоматического масштабирования;
- обеспечивать явное разделение ресурсов, доступных извне и внутри системы;
- обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п.
<br>
Обоснуйте свой выбор.

### Решение
Можно рассмотреть два варианта реализации указанных требований: условно, "большой" и "маленький".
- Большой вариант - предполагает использование Kubernetes. Большой, т.к. требует развертывания и сопровождения Kubernetes кластера, что оправдано для больших и нагруженных приложений, но для небольших и слабонагруженных - выглядит как "из пушки по воробьям"
- Маленький вариант - без использования Kubernetes, что может подойти для малонагруженных приложений, или как промежуточный шаг при движении в сторону контейнерных оркестраторов
<p>
В обоих вариантах фокус на минимизацию количества используемых инструментов.

| Требование   | "Большой" вариант | "Маленький" вариант |
|---------------------------------|-------------------------|----------------|
| поддержка контейнеров;                                        | Kubernetes | Docker Compose |
| обеспечивать обнаружение сервисов и маршрутизацию запросов;   | Zookeeper | API Gateway на NGINX |
| обеспечивать возможность горизонтального масштабирования;     | Kubernetes (масштабирование добавлением PODов); для взаимодействия компонентов приложения между собой использовать какой-либо менеджер очередей, например RabbitMQ | балансировка на NGINX |
| обеспечивать возможность автоматического масштабирования;     | Kubernetes (POD autoscaling) | потребует скриптотехники, например, автоматизации добавления бэкенд серверов в балансировку NGINX с помощью LUA |
| обеспечивать явное разделение ресурсов, доступных извне и внутри системы;| балансировщик (Ingress) | уже имеющийся NGINX и сетевое разделение: создание public и private сети |
| обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п.| Hashicorp Vault | Secrets в Docker Compose |